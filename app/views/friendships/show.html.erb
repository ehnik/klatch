<br>
<h2>Your Friends</h2>

<ul>
<% if @user.friends.length > 0 %>
<% @user.friends.each do |friend| %>
    <li>
      <%= image_tag friend.avatar.thumb.url, :class => "friends-image" if friend.avatar?%>
      <%= friend.first_name + " " + friend.last_name %>
      <%= link_to "Delete", delete_friend_path(:user_id=>current_user.id, :friend_id=>friend.id),
      :method => :delete, data: { confirm: "You are about to remove #{friend.first_name} as a friend. You will no longer be able to see his/her articles. Are you sure?" } %>
    </li>
  <% end %>
</ul>

<% else %>
<p> You don't have any friends yet! </p>
<% end %>

<h3> Add friends </h3>
<p> Search for people you know </p>

<%= form_tag({:controller => "friendships", :action => "show"}, :method => :get, id: "search-form") do %>
    <%= text_field_tag :search, params[:search], placeholder: "Search Users" %>
    <%= submit_tag "Search", :name => nil %>
<% end %>

<% if @users %>
  <ul>
  <% @users.each do |user| %>
    <li>
    <% if Friendship.where(:user_id => current_user.id, :friend_id => user.id).exists? %>
    <p> <%=image_tag user.avatar.thumb.url, :class => "friends-search" if user.avatar?%> <%="#{user.first_name} #{user.last_name}"%> (currently friends) </p>
    <% elsif Request.where({requestee_id:user.id, requester_id:current_user.id}).length>0%>
    <p> <%=image_tag user.avatar.thumb.url, :class => "friends-search" if user.avatar?%> <%=user.first_name + " " + user.last_name %> (friend request pending) </p>
    <% elsif user.id!=current_user.id%>
    <%=image_tag user.avatar.thumb.url, :class => "friends-search" if user.avatar?%> <%="#{user.first_name} #{user.last_name}"%> <%=link_to "Send friend request", requests_index_path(requestee_id: user.id, requester_id: current_user.id, results: params[:search]), :method => :post %>
    </li>
    <% end %>
  </ul>
<% end %>
<% end %>
